#! /bin/bash

BATTERY_NUMBER=0

acpiOutput=`acpi -V | grep "Battery $BATTERY_NUMBER"`
status=`echo $acpiOutput | head -n 1 | sed "s/Battery $BATTERY_NUMBER\: //" | cut -d"," -f1`
[[ $status == "Discharging" ]] && ss="v" || ss="^"
perc=`echo $acpiOutput | head -n 1 | sed "s/Battery $BATTERY_NUMBER\: //" | cut -d"," -f2 | sed "s/ //" | sed "s/%//"`
remaining=`echo $acpiOutput | grep -Eo "[0-9]+:[0-9]+"`
# Treshold varia a seconda della capacit√† massima di carica della batteria, per tenere conto del suo invecchiamento
treshold=`bc <<< "105 - $(acpi -V | grep "last full capacity" | grep -o ".[0-9]*%" | sed "s/%//")"`

echo "$perc% $ss, $remaining"
echo "$perc"

case ${BLOCK_BUTTON} in
    3) notify-send --urgency=low "SYSTEM STATUS" "NET\n$(nmcli -a | grep "\(wlp3s0\|enp2s0\)" | head -n 2)\n\nDBX\n$(dropbox status)\n\nSCREEN\n$(redshift -p)\n\nBAT\n$(acpi -V | grep "Battery")";;
    *)
esac

if [ $status == "Discharging" ] && [ $perc -le $treshold ]; then
    exit 33
fi
