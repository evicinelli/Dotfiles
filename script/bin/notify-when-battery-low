#! /bin/bash
export DISPLAY=:0
PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/home/vic/.fzf/bin

acpiOutput=`acpi -V | grep "Battery $BATTERY_NUMBER"`
status=`echo $acpiOutput | grep "Battery $BATTERY_NUMBER" | head -n 1 | sed "s/Battery $BATTERY_NUMBER\: //" | cut -d"," -f1`
perc=`echo $acpiOutput | grep "Battery $BATTERY_NUMBER" | head -n 1 | sed "s/Battery $BATTERY_NUMBER\: //" | cut -d"," -f2 | sed "s/ //" | sed "s/%//"`
remaining=`echo $acpiOutput | grep "Battery $BATTERY_NUMBER" | head -n 1 | sed "s/Battery $BATTERY_NUMBER\: //" | cut -d"," -f3 | sed "s/ remaining.*//"`
treshold=10
maxCapacity=$(acpi -V | grep "last full capacity" | grep -o ".[0-9]*%" | sed "s/%//")

if [ $status == "Discharging" ] && [ $perc -le $treshold ] && [ ! -f /tmp/battery-dnd ]; then
    notify-send DUNST_COMMAND_RESUME
    notify-send --urgency=critical "BATTERIA SCARICAAAAAA ($perc%) " "Mettila in carica, muvèt!!"
fi

if [ $maxCapacity -le 5 ] && [ ! -f /tmp/told-battery-broken  ] ; then
    touch /tmp/told-battery-broken;
    notify-send --urgency=critical "Batteria rotta, cambiala" "La capacità di carica massima è $maxCapacity"
fi
