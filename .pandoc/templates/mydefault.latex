% vim: fdm=marker

\documentclass[10pt, headings=standardclasses]{scrartcl}

% PassOptions {{{
\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
% }}}

% Usepackage {{{
\usepackage[heightrounded, margin=4cm, marginpar=3cm]{geometry}
\usepackage{amssymb,amsmath}
\usepackage{caption}
\usepackage{chemfig}            % Typeset molecules
\usepackage{fancyhdr}           % Header and footers
\usepackage{fancyvrb}
\usepackage{fixltx2e}           % provides \textsubscript
\usepackage{float}              % Control how images float
\usepackage{ifxetex,ifluatex}
\usepackage{listings}
\usepackage{longtable,booktabs}
\usepackage{newunicodechar}     % Unicode where it's needed
\usepackage{tcolorbox}          % Boxes
\usepackage{titlesec}           % Customize titles
\usepackage{xcolor}             % Colors!
\usepackage{marvosym}
\usepackage{qrcode}
% }}}

% pdfTEX {{{
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
    \usepackage[T1]{fontenc}
    \usepackage[utf8]{inputenc}
    \usepackage{textcomp} % provides euro and other symbols
    \usepackage[
        activate=true,
        protrusion=true,
        expansion=true,
        final,
        tracking=true,
        kerning=true,
        spacing=true,
        factor=1100,
        stretch=10,
        shrink=10
        ]{microtype} % Typographic perfection, sadly only with pdftex
    \usepackage{libertine, libertinust1math} % Libertinus Font family
\fi
% }}}

% XeTEX {{{
\ifxetex
    \usepackage[MnSymbol]{mathspec}
    \usepackage[]{microtype} % At least we have protrusion
    \setmainfont[Numbers=OldStyle]{Minion Pro}
    \setsansfont{Myriad Pro}
    \setmonofont{Source Code Pro}
    \setmathfont(Digits,Latin,Greek)[]{Minion Pro}
\fi
% }}}

% Hyperref {{{
\usepackage{hyperref}
\hypersetup{
    $if(title-meta)$
    pdftitle={$title-meta$},
    $endif$
    $if(author-meta)$
    pdfauthor={$author-meta$},
    $endif$
    $if(keywords)$
    pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
    $endif$
    colorlinks=true,
    linkcolor=Maroon,
    citecolor=BlueViolet,
    urlcolor=Blue,
    breaklinks=true}
\urlstyle{mono}  % don't use monospace font for urls
% }}}

% Titlesec {{{
% \titleformat{command}[shape]{format}{label}{sep}{before-code}[after-code]
\titleformat{\part}{\flushright\huge\normalfont\itshape}{\thepart}{1em}{}[\vspace{8em}]  % \part
\titleformat{\chapter}{\huge\normalfont\scshape\lowercase}\thechapter{}{0em}{}           % Book class
\titleformat{\section}{\huge\normalfont\scshape\lowercase}{\thesection}{1em}{}           % # Header #
\titleformat{\subsection}{\LARGE\bfseries}{}{0em}{}                                      % ## Header ##
\titleformat{\subsubsection}{\Large\bfseries}{}{0em}{}                                   % ### Header ###
\titleformat{\paragraph}{\large\bfseries}{}{0em}{}                                       % #### Header ####
\titleformat{\subparagraph}{\normalfont\bfseries}{}{0em}{}                               % ##### Header #####
\titleformat{\subsubparagraph}{\itshape}{}{0em}{}
% }}}

% Footnotes {{{
% no rule, more space
\renewcommand\footnoterule{}
\setlength{\skip\footins}{3em}

% Verbatim allowed
\VerbatimFootnotes % allows verbatim text in footnotes
\IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{longtable}}{}
% }}}

% Margin notes 1{{{
\newcommand{\marginfig}[1]{\marginpar{{\textsf{Vedi \textbf{Figura \ref{#1}}}}}}
\newcommand{\marginnote}[1]{\marginpar{← \textsf{#1}}}
\newcommand{\asidefigure}[2]{\marginpar{\textsf{\includegraphics{#1}\\ \emph{#2}}}}
% }}}1

% Language {{{
$if(lang)$
    \ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
        \usepackage[shorthands=off,$for(babel-otherlangs)$$babel-otherlangs$,$endfor$main=$babel-lang$]{babel}
        $if(babel-newcommands)$
        $babel-newcommands$
        $endif$
    \else % if ! pdftex
        % load polyglossia as late as possible as it *could* call bidi if RTL lang (e.g. Hebrew or Arabic)
        \usepackage{polyglossia}
        \setmainlanguage[$polyglossia-lang.options$]{$polyglossia-lang.name$}
        $for(polyglossia-otherlangs)$
        \setotherlanguage[$polyglossia-otherlangs.options$]{$polyglossia-otherlangs.name$}
        $endfor$
        \fi
$else$
    \usepackage[italian]{babel}
$endif$
% }}}

% Biblatex and citations {{{
$if(biblatex)$
    \usepackage[$if(biblio-style)$style=$biblio-style$,$endif$$for(biblatexoptions)$$biblatexoptions$$sep$,$endfor$]{biblatex}
    $for(bibliography)$
        \addbibresource{$bibliography$}
    $endfor$
$endif$
% }}}

% Title, date and author {{{
$if(title)$
    \title{$title$$if(thanks)$\thanks{$thanks$}$endif$}
$endif$
$if(subtitle)$
    \providecommand{\subtitle}[1]{}
    \subtitle{$subtitle$}
$endif$
$if(author)$
    \author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
$if(institute)$
    \providecommand{\institute}[1]{}
    \institute{$for(institute)$$institute$$sep$ \and $endfor$}
$endif$
    \date{$date$}
% }}}

% Unicode {{{
\newunicodechar{½}{\(\frac{1}{2}\)}
\newunicodechar{¼}{\(\frac{1}{4}\)}
\newunicodechar{¾}{\(\frac{3}{4}\)}
\newunicodechar{⅔}{\(\frac{2}{3}\)}
\newunicodechar{⅓}{\(\frac{1}{3}\)}
\newunicodechar{¬}{\(\neg\)}
\newunicodechar{±}{\(\pm\)}
\newunicodechar{×}{\(\times\)}
\newunicodechar{÷}{\(\div\)}
\newunicodechar{…}{\(\dots\)}
\newunicodechar{←}{\(\leftarrow\)}
\newunicodechar{↑}{\(\uparrow\)}
\newunicodechar{→}{\(\rightarrow\)}
\newunicodechar{🡪}{\(\rightarrow\)}
\newunicodechar{↓}{\(\downarrow\)}
\newunicodechar{↔}{\(\leftrightarrow\)}
\newunicodechar{⇒}{\(\Rightarrow\)}
\newunicodechar{⇐}{\(\Leftarrow\)}
\newunicodechar{⇔}{\(\Leftrightarrow\)}
\newunicodechar{∀}{\(\forall\)}
\newunicodechar{∃}{\(\exists\)}
\newunicodechar{∅}{\(\emptyset\)}
\newunicodechar{∈}{\(\in\)}
\newunicodechar{∉}{\(\notin\)}
\newunicodechar{∋}{\(\ni\)}
\newunicodechar{∎}{\(\blacksquare\)}
\newunicodechar{∑}{\(\sum\)}
\newunicodechar{∓}{\(\mp\)}
\newunicodechar{∗}{\(\ast\)}
\newunicodechar{∘}{\(\circ\)}
\newunicodechar{∙}{\(\bullet\)}
\newunicodechar{∝}{\(\propto\)}
\newunicodechar{∞}{\(\infty\)}
\newunicodechar{∥}{\(\parallel\)}
\newunicodechar{∧}{\(\land\)}
\newunicodechar{∨}{\(\lor\)}
\newunicodechar{∩}{\(\cap\)}
\newunicodechar{∪}{\(\cup\)}
\newunicodechar{∴}{\(\therefore\)}
\newunicodechar{∵}{\(\because\)}
\newunicodechar{≈}{\(\approx\)}
\newunicodechar{≠}{\(\neq\)}
\newunicodechar{≡}{\(\equiv\)}
\newunicodechar{≤}{\(\leq\)}
\newunicodechar{≥}{\(\geq\)}
\newunicodechar{⊂}{\(\subset\)}
\newunicodechar{⊃}{\(\supset\)}
\newunicodechar{⊆}{\(\subseteq\)}
\newunicodechar{⊇}{\(\supseteq\)}
\newunicodechar{⊢}{\(\vdash\)}
\newunicodechar{⊤}{\(\top\)}
\newunicodechar{⊥}{\(\bot\)}
\newunicodechar{⊨}{\(\vDash\)}
\newunicodechar{⋅}{\(\cdot\)}
\newunicodechar{⋮}{\(\vdots\)}
\newunicodechar{⋯}{\(\cdots\)}
\newunicodechar{°}{\(^{\circ}\)}
% }}}

% Pandoc stuff {{{
$if(linestretch)$
    \usepackage{setspace}
    \setstretch{$linestretch$}
$endif$

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}

% Indent
$if(indent)$
$else$
    \IfFileExists{parskip.sty}{\usepackage{parskip}}{\setlength{\parindent}{0pt} \setlength{\parskip}{6pt plus 2pt minus 1pt} }
$endif$
\newcommand{\passthrough}[1]{#1}

% These lines are needed to make table captions work with longtable:
\makeatletter
\def\fnum@table{\tablename~\thetable}
\makeatother

% Prevent overfull lines
\setlength{\emergencystretch}{3em}
\providecommand{\tightlist}{%
\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{1}

% Figure placement
\makeatletter
\def\fps@figure{htbp}
\makeatother

$if(graphics)$
    \usepackage{graphicx,grffile}
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
    \def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
    \makeatother
    % Scale images if necessary, so that they will not overflow the page
    % margins by default, and it is still possible to overwrite the defaults
    % using explicit options in \includegraphics[width, height, ...]{}
    \setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$
% }}}

% Make `pandoc -H` work
$for(header-includes)$
    $header-includes$
$endfor$

\begin{document}
    % Title
    $if(title)$
    \maketitle
    $endif$

    % Abstract
    $if(abstract)$
        \begin{abstract}
            $abstract$
        \end{abstract}
    $endif$

    % Body
    $body$

    % Bibliography
    $if(natbib)$
    $if(bibliography)$
    $if(biblio-title)$
        $if(book-class)$
            \renewcommand\bibname{$biblio-title$}
        $else$
            \renewcommand\refname{$biblio-title$}
        $endif$
    $endif$
    $endif$
    $endif$

    $if(biblatex)$
        \printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$
    $endif$
\end{document}
